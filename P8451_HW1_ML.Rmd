---
title: "P8451_HW1_ML"
date: "2024-01-17"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
```

# import data

```{r import_data, message=FALSE, results='hide'}
bcdata = read_csv("bcdata_Assignment1.csv") |> janitor::clean_names()
```

# Q1 get quantitative fesures

```{r q1_quantitative_features}

summary = skimr::skim(bcdata) |> 
  select(skim_variable, numeric.mean, numeric.p50, numeric.p0, numeric.p100) |> knitr::kable(digits = 2) |> print()
# There's no missing in this dataset.

```

# Q2 catogorize bmi based on WHO criteria

```{r q2_recoding, results='hide'}
q2 = bcdata |> mutate(who_bmi =
                   ifelse(bmi < 16.5, "Severely underweight",
                          ifelse(16.5 <= bmi & bmi < 18.5, "Underweight",
                                 ifelse(18.5 <= bmi & bmi < 25, "Normal weight",
                                        ifelse(25 <= bmi & bmi < 30, "Overweight", 
                                               ifelse(30 <= bmi & bmi < 35, "Obesity class I",
                                                      ifelse(35 <= bmi & bmi < 40, "Obesity class II","Obesity class III"))))))) |> 
  mutate(classification = recode(classification, "1" = "Healthy Controls", "2" = "Breast Cancer Patients")) |> arrange(bmi)



#check if I have recoded bmi correctly
table(q2$bmi, q2$who_bmi)


```

# Q3 draw bar plot


```{r q3_barchart, width = 8, height = 6, message=FALSE, warning=FALSE}
#Since there's no healthy controls in underweight category, I added a category "underweight healthhy controls" with 0 count to make sure every column has the same width.
freq_table = q2 |> group_by(who_bmi, classification) |>
  summarise(n = n()) |> mutate(proportion = n / sum(n) * 100)

supp = data.frame(who_bmi = "Underweight", 
              classification = "Healthy Controls",
              n = 0, proportion = 0)

final_freq = bind_rows(supp, freq_table) |> mutate(who_bmi = as.factor(who_bmi)) 

level = c("Severely underweight", "Underweight", "Normal weight", "Overweight", "Obesity class I", "Obesity class II", "Obesity class III")

final_freq |> 
  mutate(who_bmi = forcats::fct_relevel(who_bmi, level),
         text_label = str_c(proportion, "%")) |>
  plot_ly(x = ~who_bmi, y = ~proportion, color = ~classification, type = "bar", colors = "viridis", text = ~text_label) |>
  layout(title = 'Barplot showing the proportion of breast cancer cases and controls by WHO BMI category', xaxis = list(title = 'WHO BMI Category'), yaxis = list(title = 'Proportion(%)'), barmode = "stack")
  

```

* The proportion of each BMI category are cases and the proportion of each BMI category are controls are clearly showed on the stacked proportional bar chart,if you put the mouse on the bar.

* But I think a barchart showing porportion of the whole sample within each category.(each category doesn't accounted for 1) is more informative.

# Q4 regression model

```{r regression_model, message=FALSE}

q4 = bcdata |> 
  mutate(classification = recode(classification, "1" = 0, "2" = 1))
# recode 1-healthy controls as "0", 2-breast cancer patients as "1"
table(q4$classification, bcdata$classification)
# recoded correctly

mylogit = glm(classification ~ glucose + homa + leptin + bmi + age, data = q4, family = "binomial")
mylogit |> broom::tidy() |> knitr::kable(digits = 2)
cbind(estimate = coef(mylogit), confint(mylogit)) |> knitr::kable(digits = 2)
exp(cbind(OR = coef(mylogit), confint(mylogit))) |> knitr::kable(digits = 2)

```

* Estimate: for HOMA-IR, the beta estimate is 0.27,and 95% confidence interval is (-0.03, 0.65).

* OR: for HOMA-IR, the OR is 1.32,and 95% confidence interval is (0.97, 1.92).

* Interpretation: The odds of developing breast cancer increase by 1.32 unit with  1-unit increase in HOMA-IR. I am 95% confident that the true OR lies between 0.97 and 1.92. p-value = 0.11 > 0.05.We cannot reject the null hypothesis that the HOMA-IR level has no association with breast cancer at a 5% level of significance. We have insufficient evidence to support that HOMA-IR is significantly associated with breast cancer, adjusting for glucose, leptin, bmi and age.

# Q5 linear regression

```{r linear regression, message=FALSE}
q5 = bcdata
fit = lm(insulin ~ bmi + age + glucose, data = q5)
fit |> broom::tidy() |> knitr::kable(digits = 2)
cbind(estimate = coef(fit), confint(fit)) |> knitr::kable(digits = 2)

```

* Estimate: for age, the beta estimate is -0.05,and 95% confidence interval is (-0.16, 0.05). 

* Interpretation: The level of insulin decreases by 0.05 μU/mL with one-year increase in age, adjusting for bmi and glucose.I am 95% confident that the true change lies between -0.16 and 0.05 μU/mL. p-value = 0.30 > 0.05.We cannot reject the null hypothesis that age has no association with insulin level at a 5% level of significance. We have insufficient evidence to support that age is significantly associated with insulin level, adjusting for bmi and glucose.
